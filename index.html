<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viento & Pichuchis ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Dancing+Script:wght@700&family=Pacifico&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --pink: #fb6f92; --soft: #fff0f3; --dark-pink: #ff4d6d; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Quicksand', sans-serif; }
        
        body { 
            background: #050505; 
            overflow: hidden; 
            height: 100vh; 
            color: white;
        }

        /* Fondo de Snoopy con mezcla oscura para que resalten las part√≠culas */
        .snoopy-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://w0.peakpx.com/wallpaper/599/238/HD-wallpaper-snoopy-love-dog-heart-pink-thumbnail.jpg');
            background-size: cover; background-position: center; z-index: -1;
        }

        #windCanvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }

        nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
            padding: 10px 20px; border-radius: 50px; display: flex; gap: 15px; z-index: 100;
            border: 1px solid rgba(251, 111, 146, 0.5);
        }
        nav button { background: none; border: none; color: white; font-weight: 700; cursor: pointer; font-size: 0.7rem; transition: 0.3s; }
        nav button:hover { color: var(--pink); text-shadow: 0 0 10px var(--pink); }

        .page {
            position: absolute; width: 100%; height: 100vh; z-index: 10;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; text-align: center;
        }
        .page.active { display: flex; animation: fade 0.8s ease; }

        /* Estilo letras de "Viento" */
        .lyrics-container { font-family: 'Dancing Script', cursive; font-size: 2.2rem; color: var(--pink); min-height: 150px; text-shadow: 0 0 15px rgba(251,111,146,0.5); }
        
        /* Widgets */
        .timer { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 20px; border: 1px solid var(--pink); backdrop-filter: blur(5px); margin-bottom: 20px; }
        .grid { display: flex; gap: 15px; }
        .num { font-size: 1.8rem; font-weight: 700; color: var(--pink); }
        .label { font-size: 0.6rem; color: #ccc; }

        /* Dedicatoria */
        .msg-box { background: rgba(255,255,255,0.1); border: 1px solid var(--pink); padding: 15px; border-radius: 15px; width: 300px; margin-top: 20px; }
        textarea { width: 100%; background: transparent; border: none; color: white; resize: none; border-bottom: 1px solid var(--pink); margin-bottom: 10px; padding: 5px; outline: none; }
        
        .polaroid { 
            background: white; padding: 8px 8px 25px 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
            width: 130px; transform: rotate(var(--r)); margin: 10px; color: #333;
        }
        .polaroid img { width: 100%; height: 110px; object-fit: cover; }

        .btn { background: var(--pink); color: white; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; font-weight: 700; }
        
        @keyframes fade { from { opacity: 0; filter: blur(10px); } to { opacity: 1; filter: blur(0); } }
        .heart { position: absolute; pointer-events: none; animation: floatUp 1.5s forwards; z-index: 1000; }
        @keyframes floatUp { to { transform: translateY(-100px) scale(0); opacity: 0; } }
    </style>
</head>
<body onclick="createHeart(event.clientX, event.clientY)">

    <div class="snoopy-bg"></div>
    <canvas id="windCanvas"></canvas>

    <nav>
        <button onclick="show(0)">VIENTO</button>
        <button onclick="show(1)">√ÅLBUM</button>
        <button onclick="show(2)">DEDICATORIA</button>
        <button onclick="show(3)">PLAYLIST</button>
    </nav>

    <div class="page active" id="p0">
        <h1 style="font-family:'Cinzel'; letter-spacing: 10px; font-size: 3rem; margin-bottom: 10px;">PICHUCHIS</h1>
        <div class="timer">
            <div class="grid">
                <div><span class="num" id="d">0</span><br><span class="label">D√çAS</span></div>
                <div><span class="num" id="h">0</span><br><span class="label">HRS</span></div>
                <div><span class="num" id="m">0</span><br><span class="label">MIN</span></div>
                <div><span class="num" id="s">0</span><br><span class="label">SEG</span></div>
            </div>
        </div>
        <div class="lyrics-container" id="lyrics-display">Cargando magia...</div>
    </div>

    <div class="page" id="p1">
        <h2 style="font-family:'Pacifico'; color:var(--pink);">Nuestros Recuerdos</h2>
        <button class="btn" onclick="document.getElementById('p-in').click()">SUBIR RECUERDO üì∏</button>
        <input type="file" id="p-in" accept="image/*" style="display:none">
        <div id="album" style="display: flex; flex-wrap: wrap; justify-content: center; overflow-y: auto; max-height: 60vh; width: 100%;"></div>
    </div>

    <div class="page" id="p2">
        <h2 style="font-family:'Pacifico'; color:var(--pink);">Escr√≠beme algo...</h2>
        <div class="msg-box">
            <textarea id="msg-input" placeholder="Tu mensaje aqu√≠..." rows="3"></textarea>
            <button class="btn" id="send-msg">ENVIAR CORAZ√ìN ‚ù§Ô∏è</button>
        </div>
        <div id="messages-stream" style="margin-top:20px; font-family:'Dancing Script'; font-size: 1.5rem; color: #ffccd5; max-width: 80%;"></div>
    </div>

    <div class="page" id="p3">
        <h2 style="font-family:'Pacifico'; color:var(--pink);">Nuestras  Canciones</h2>
        <audio id="player" controls style="margin:20px;"></audio>
        <button class="btn" onclick="document.getElementById('m-in').click()">CARGAR CANCI√ìN üéµ</button>
        <input type="file" id="m-in" accept="audio/*" style="display:none">
        <div id="songs" style="background: rgba(255,255,255,0.1); width: 300px; border-radius: 15px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        // CONFIGURACI√ìN FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyAFji82Fx43sym6svAkE7u5ZKf7irC2UrE",
            authDomain: "nuestra-fecha-16-11-2025.firebaseapp.com",
            databaseURL: "https://nuestra-fecha-16-11-2025-default-rtdb.firebaseio.com/", 
            projectId: "nuestra-fecha-16-11-2025",
            storageBucket: "nuestra-fecha-16-11-2025.firebasestorage.app",
            messagingSenderId: "443902042832",
            appId: "1:443902042832:web:028ca83ab6ab87f8ef34d5"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // NAVEGACI√ìN
        window.show = (i) => {
            document.querySelectorAll('.page').forEach((p, idx) => p.classList.toggle('active', i === idx));
        };

        // CONTADOR
        const start = new Date('2025-11-16T00:00:00').getTime();
        setInterval(() => {
            const diff = Date.now() - start;
            document.getElementById('d').innerText = Math.floor(diff / 86400000);
            document.getElementById('h').innerText = Math.floor((diff / 3600000) % 24).toString().padStart(2,'0');
            document.getElementById('m').innerText = Math.floor((diff / 60000) % 60).toString().padStart(2,'0');
            document.getElementById('s').innerText = Math.floor((diff / 1000) % 60).toString().padStart(2,'0');
        }, 1000);

        // --- SISTEMA DE VIENTO REVISADO ---
        const canv = document.getElementById('windCanvas');
        const ctx = canv.getContext('2d');
        let width, height;
        const resize = () => { width = canv.width = window.innerWidth; height = canv.height = window.innerHeight; };
        window.addEventListener('resize', resize); resize();

        let particles = [];
        const words = ["Noviembre", "2025", "Love", "Pichuchis", "16", "‚ù§Ô∏è"];
        
        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = Math.random() * 2 + 1;
                this.vy = Math.random() * 1 - 0.5;
                this.text = words[Math.floor(Math.random()*words.length)];
                this.size = Math.random() * 15 + 10;
                this.opacity = Math.random() * 0.5 + 0.1;
            }
            update(audioLevel) {
                this.x += this.vx * (1 + audioLevel * 5);
                this.y += this.vy;
                if(this.x > width) this.x = -50;
            }
            draw() {
                ctx.globalAlpha = this.opacity;
                ctx.fillStyle = "#fb6f92";
                ctx.font = `italic ${this.size}px 'Dancing Script'`;
                ctx.fillText(this.text, this.x, this.y);
            }
        }
        for(let i=0; i<50; i++) particles.push(new Particle());

        // AUDIO VISUALIZER
        let audioCtx, analyser, dataArray;
        const player = document.getElementById('player');
        player.onplay = () => {
            if(!audioCtx) {
                audioCtx = new AudioContext();
                analyser = audioCtx.createAnalyser();
                const src = audioCtx.createMediaElementSource(player);
                src.connect(analyser); analyser.connect(audioCtx.destination);
                dataArray = new Uint8Array(analyser.frequencyBinCount);
            }
        };

        function animate() {
            ctx.clearRect(0,0,width,height);
            let level = 0;
            if(analyser) {
                analyser.getByteFrequencyData(dataArray);
                level = dataArray[5] / 255;
            }
            particles.forEach(p => { p.update(level); p.draw(); });
            requestAnimationFrame(animate);
        }
        animate();

        // LETRAS DIN√ÅMICAS (VIENTO)
        const lyrics = ["Pr√©stame tu peine", "Y p√©iname el alma", "Desenr√©dame", "Fuera de este mundo", "Viento am√°rranos", "Tiempo detente muchos a√±os"];
        let lyricIdx = 0;
        setInterval(() => {
            const el = document.getElementById('lyrics-display');
            el.style.opacity = 0;
            setTimeout(() => {
                el.innerText = lyrics[lyricIdx];
                el.style.opacity = 1;
                lyricIdx = (lyricIdx + 1) % lyrics.length;
            }, 500);
        }, 4000);

        // FIREBASE: FOTOS
        document.getElementById('p-in').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => push(ref(db, 'fotos'), { img: ev.target.result });
            reader.readAsDataURL(e.target.files[0]);
        };
        onChildAdded(ref(db, 'fotos'), (snap) => {
            const div = document.createElement('div'); div.className = 'polaroid';
            div.style.setProperty('--r', (Math.random()*10-5)+'deg');
            div.innerHTML = `<img src="${snap.val().img}"><p style="font-size:0.7rem; text-align:center;">Recuerdos que los llevo tatuado en el alma como llevo la fecha 16-11-2025, Te amooo mi Pichuchis ‚ù§Ô∏è</p>`;
            document.getElementById('album').prepend(div);
        });

        // FIREBASE: DEDICATORIAS
        document.getElementById('send-msg').onclick = () => {
            const val = document.getElementById('msg-input').value;
            if(val) {
                push(ref(db, 'mensajes'), { text: val });
                document.getElementById('msg-input').value = '';
            }
        };
        onChildAdded(ref(db, 'mensajes'), (snap) => {
            const stream = document.getElementById('messages-stream');
            stream.innerText = `"${snap.val().text}"`;
            stream.animate([{opacity:0, transform:'scale(0.8)'}, {opacity:1, transform:'scale(1)'}], 1000);
        });

        // FIREBASE: M√öSICA
        document.getElementById('m-in').onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (ev) => push(ref(db, 'musica'), { name: file.name, src: ev.target.result });
            reader.readAsDataURL(file);
        };
        onChildAdded(ref(db, 'musica'), (snap) => {
            const d = document.createElement('div'); d.style.padding = "10px"; d.style.cursor = "pointer";
            d.innerText = "üéµ " + snap.val().name;
            d.onclick = () => { player.src = snap.val().src; player.play(); };
            document.getElementById('songs').prepend(d);
        });

        // EFECTO CORAZONES
        window.createHeart = (x, y) => {
            const h = document.createElement('div'); h.className = 'heart';
            h.innerHTML = '‚ù§Ô∏è'; h.style.left = x+'px'; h.style.top = y+'px';
            h.style.fontSize = Math.random()*20+15+'px'; document.body.appendChild(h);
            setTimeout(() => h.remove(), 1500);
        };
    </script>
</body>
</html>
